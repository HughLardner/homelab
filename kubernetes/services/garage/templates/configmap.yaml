---
# Garage Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: garage-config
  namespace: {{ .Release.Namespace }}
  labels:
    app.kubernetes.io/name: garage
    app.kubernetes.io/instance: {{ .Release.Name }}
data:
  garage.toml: |
    # Garage configuration for single-node homelab deployment
    # https://garagehq.deuxfleurs.fr/documentation/reference-manual/configuration/

    metadata_dir = "/var/lib/garage/meta"
    data_dir = "/var/lib/garage/data"
    db_engine = "lmdb"

    replication_factor = 1

    [rpc]
    bind_addr = "[::]:3901"
    # rpc_secret is set via environment variable GARAGE_RPC_SECRET

    [s3_api]
    s3_region = "garage"
    api_bind_addr = "[::]:3900"
    root_domain = ".s3.{{ .Values.global.domain | default "silverseekers.org" }}"

    [s3_web]
    bind_addr = "[::]:3902"
    root_domain = ".web.{{ .Values.global.domain | default "silverseekers.org" }}"

    [admin]
    api_bind_addr = "[::]:3903"
    # admin_token is set via environment variable GARAGE_ADMIN_TOKEN

