---
# CoreDNS ConfigMap - Corefile Configuration
# Configures CoreDNS to serve silverseekers.org from etcd and forward other queries
#
# DNS Flow:
# 1. Query for *.silverseekers.org → Look up in etcd (/skydns path)
# 2. Query for other domains → Forward to Cloudflare (1.1.1.1)

apiVersion: v1
kind: ConfigMap
metadata:
  name: coredns-config
  namespace: coredns-local
  labels:
    app: coredns
    app.kubernetes.io/name: coredns
    app.kubernetes.io/component: dns-server
data:
  Corefile: |
    # Serve silverseekers.org from etcd
    silverseekers.org:53 {
        errors
        log
        health :8080
        ready :8181

        # Read DNS records from etcd (SkyDNS format)
        etcd {
            path /skydns
            endpoint http://coredns-etcd-client:2379
        }

        # Cache responses for 30 seconds
        cache 30

        # Load balance between multiple A records
        loadbalance
    }

    # Forward all other queries to Cloudflare DNS
    .:53 {
        errors
        log
        health :8080
        ready :8181

        # Forward to Cloudflare public DNS
        forward . 1.1.1.1 1.0.0.1

        # Cache responses for 30 seconds
        cache 30
    }
