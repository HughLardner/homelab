---
# Authelia ForwardAuth Middleware
# Use this middleware on IngressRoutes to protect services with Authelia
#
# Usage in IngressRoute:
#   middlewares:
#     - name: authelia-forward-auth
#       namespace: authelia
#
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: authelia-forward-auth
  namespace: {{ .Release.Namespace }}
  labels:
    app.kubernetes.io/name: authelia
    app.kubernetes.io/component: middleware
spec:
  forwardAuth:
    # Authelia's forward auth endpoint
    address: http://authelia.{{ .Release.Namespace }}.svc.cluster.local/api/authz/forward-auth
    trustForwardHeader: true
    # Headers to pass to the backend service
    authResponseHeaders:
      - Remote-User
      - Remote-Groups
      - Remote-Email
      - Remote-Name

---
# Basic Auth Middleware (fallback for services that don't need full SSO)
# Simpler alternative when you just need username/password protection
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: authelia-basic
  namespace: {{ .Release.Namespace }}
  labels:
    app.kubernetes.io/name: authelia
    app.kubernetes.io/component: middleware
spec:
  forwardAuth:
    address: http://authelia.{{ .Release.Namespace }}.svc.cluster.local/api/authz/forward-auth/basic
    trustForwardHeader: true
    authResponseHeaders:
      - Remote-User
      - Remote-Groups
