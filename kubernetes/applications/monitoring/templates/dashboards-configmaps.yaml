---
# =============================================================================
# Grafana Dashboard ConfigMaps
# =============================================================================
# These ConfigMaps are automatically picked up by the Grafana sidecar
# Label: grafana_dashboard=1
#
# Dashboard JSON is downloaded from Grafana.com on pod startup
# Using dashboard provisioning via ConfigMap annotations
# =============================================================================

---
# Traefik Dashboard
# Source: https://grafana.com/grafana/dashboards/17346
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-traefik
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
  annotations:
    grafana_folder: "Infrastructure"
data:
  traefik.json: |
    {
      "annotations": {
        "list": []
      },
      "description": "Traefik dashboard with key metrics",
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "links": [],
      "liveNow": false,
      "panels": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "palette-classic"},
              "mappings": [],
              "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]},
              "unit": "short"
            }
          },
          "gridPos": {"h": 4, "w": 6, "x": 0, "y": 0},
          "id": 1,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "10.0.0",
          "targets": [{"expr": "sum(traefik_entrypoint_open_connections)", "refId": "A"}],
          "title": "Open Connections",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "palette-classic"},
              "mappings": [],
              "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]},
              "unit": "reqps"
            }
          },
          "gridPos": {"h": 4, "w": 6, "x": 6, "y": 0},
          "id": 2,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "10.0.0",
          "targets": [{"expr": "sum(rate(traefik_entrypoint_requests_total[5m]))", "refId": "A"}],
          "title": "Requests/sec",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "palette-classic"},
              "mappings": [],
              "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 0.1}, {"color": "red", "value": 1}]},
              "unit": "percentunit"
            }
          },
          "gridPos": {"h": 4, "w": 6, "x": 12, "y": 0},
          "id": 3,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "10.0.0",
          "targets": [{"expr": "sum(rate(traefik_entrypoint_requests_total{code=~\"5..\"}[5m])) / sum(rate(traefik_entrypoint_requests_total[5m])) or vector(0)", "refId": "A"}],
          "title": "Error Rate (5xx)",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "palette-classic"},
              "mappings": [],
              "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]},
              "unit": "short"
            }
          },
          "gridPos": {"h": 4, "w": 6, "x": 18, "y": 0},
          "id": 4,
          "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "10.0.0",
          "targets": [{"expr": "count(traefik_service_server_up)", "refId": "A"}],
          "title": "Active Services",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "palette-classic"},
              "custom": {"axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false, "stacking": {"group": "A", "mode": "none"}, "thresholdsStyle": {"mode": "off"}},
              "mappings": [],
              "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]},
              "unit": "reqps"
            }
          },
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 4},
          "id": 5,
          "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "none"}},
          "targets": [{"expr": "sum by (code) (rate(traefik_entrypoint_requests_total[5m]))", "legendFormat": "{{ "{{" }}code{{ "}}" }}", "refId": "A"}],
          "title": "Requests by Status Code",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "palette-classic"},
              "custom": {"axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false, "stacking": {"group": "A", "mode": "none"}, "thresholdsStyle": {"mode": "off"}},
              "mappings": [],
              "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]},
              "unit": "s"
            }
          },
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 4},
          "id": 6,
          "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "none"}},
          "targets": [{"expr": "histogram_quantile(0.50, sum(rate(traefik_entrypoint_request_duration_seconds_bucket[5m])) by (le))", "legendFormat": "p50", "refId": "A"}, {"expr": "histogram_quantile(0.95, sum(rate(traefik_entrypoint_request_duration_seconds_bucket[5m])) by (le))", "legendFormat": "p95", "refId": "B"}, {"expr": "histogram_quantile(0.99, sum(rate(traefik_entrypoint_request_duration_seconds_bucket[5m])) by (le))", "legendFormat": "p99", "refId": "C"}],
          "title": "Request Duration",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "palette-classic"},
              "custom": {"axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false, "stacking": {"group": "A", "mode": "normal"}, "thresholdsStyle": {"mode": "off"}},
              "mappings": [],
              "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]},
              "unit": "reqps"
            }
          },
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 12},
          "id": 7,
          "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "targets": [{"expr": "sum by (service) (rate(traefik_service_requests_total[5m]))", "legendFormat": "{{ "{{" }}service{{ "}}" }}", "refId": "A"}],
          "title": "Requests by Service",
          "type": "timeseries"
        }
      ],
      "schemaVersion": 38,
      "style": "dark",
      "tags": ["traefik", "ingress"],
      "templating": {
        "list": [
          {
            "current": {"selected": false, "text": "VictoriaMetrics", "value": "VictoriaMetrics"},
            "hide": 0,
            "includeAll": false,
            "label": "Datasource",
            "multi": false,
            "name": "datasource",
            "options": [],
            "query": "prometheus",
            "refresh": 1,
            "regex": "",
            "skipUrlSync": false,
            "type": "datasource"
          }
        ]
      },
      "time": {"from": "now-1h", "to": "now"},
      "timepicker": {},
      "timezone": "",
      "title": "Traefik",
      "uid": "traefik-homelab",
      "version": 1
    }

---
# ArgoCD Dashboard
# Source: https://grafana.com/grafana/dashboards/14584
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-argocd
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
  annotations:
    grafana_folder: "Infrastructure"
data:
  argocd.json: |
    {
      "annotations": {"list": []},
      "description": "ArgoCD application sync and health status",
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "links": [],
      "liveNow": false,
      "panels": [
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}},
          "gridPos": {"h": 4, "w": 4, "x": 0, "y": 0},
          "id": 1,
          "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "count(argocd_app_info)", "refId": "A"}],
          "title": "Total Applications",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}},
          "gridPos": {"h": 4, "w": 4, "x": 4, "y": 0},
          "id": 2,
          "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "count(argocd_app_info{sync_status=\"Synced\"})", "refId": "A"}],
          "title": "Synced Apps",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 1}]}, "unit": "short"}},
          "gridPos": {"h": 4, "w": 4, "x": 8, "y": 0},
          "id": 3,
          "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "count(argocd_app_info{sync_status=\"OutOfSync\"}) or vector(0)", "refId": "A"}],
          "title": "OutOfSync Apps",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}},
          "gridPos": {"h": 4, "w": 4, "x": 12, "y": 0},
          "id": 4,
          "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "count(argocd_app_info{health_status=\"Healthy\"})", "refId": "A"}],
          "title": "Healthy Apps",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 1}]}, "unit": "short"}},
          "gridPos": {"h": 4, "w": 4, "x": 16, "y": 0},
          "id": 5,
          "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "count(argocd_app_info{health_status=\"Degraded\"}) or vector(0)", "refId": "A"}],
          "title": "Degraded Apps",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}},
          "gridPos": {"h": 4, "w": 4, "x": 20, "y": 0},
          "id": 6,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "sum(increase(argocd_app_sync_total[24h]))", "refId": "A"}],
          "title": "Syncs (24h)",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false, "stacking": {"group": "A", "mode": "none"}, "thresholdsStyle": {"mode": "off"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 4},
          "id": 7,
          "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "none"}},
          "targets": [{"expr": "sum by (name) (argocd_app_info{sync_status=\"Synced\"})", "legendFormat": "{{ "{{" }}name{{ "}}" }}", "refId": "A"}],
          "title": "Application Sync Status",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false, "stacking": {"group": "A", "mode": "none"}, "thresholdsStyle": {"mode": "off"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "ops"}},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 4},
          "id": 8,
          "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "none"}},
          "targets": [{"expr": "sum by (phase) (rate(argocd_app_sync_total[5m]))", "legendFormat": "{{ "{{" }}phase{{ "}}" }}", "refId": "A"}],
          "title": "Sync Operations",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"align": "auto", "displayMode": "auto", "inspect": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}}},
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 12},
          "id": 9,
          "options": {"footer": {"fields": "", "reducer": ["sum"], "show": false}, "showHeader": true},
          "targets": [{"expr": "argocd_app_info", "format": "table", "instant": true, "refId": "A"}],
          "title": "Application Details",
          "transformations": [{"id": "organize", "options": {"excludeByName": {"Time": true, "Value": true, "__name__": true, "instance": true, "job": true}, "indexByName": {}, "renameByName": {"dest_namespace": "Namespace", "dest_server": "Cluster", "health_status": "Health", "name": "Application", "project": "Project", "sync_status": "Sync"}}}],
          "type": "table"
        }
      ],
      "schemaVersion": 38,
      "style": "dark",
      "tags": ["argocd", "gitops"],
      "templating": {
        "list": [
          {"current": {"selected": false, "text": "VictoriaMetrics", "value": "VictoriaMetrics"}, "hide": 0, "includeAll": false, "label": "Datasource", "multi": false, "name": "datasource", "options": [], "query": "prometheus", "refresh": 1, "regex": "", "skipUrlSync": false, "type": "datasource"}
        ]
      },
      "time": {"from": "now-1h", "to": "now"},
      "timepicker": {},
      "timezone": "",
      "title": "ArgoCD",
      "uid": "argocd-homelab",
      "version": 1
    }

---
# Longhorn Dashboard
# Source: https://grafana.com/grafana/dashboards/16888
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-longhorn
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
  annotations:
    grafana_folder: "Storage"
data:
  longhorn.json: |
    {
      "annotations": {"list": []},
      "description": "Longhorn storage metrics",
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "links": [],
      "liveNow": false,
      "panels": [
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}},
          "gridPos": {"h": 4, "w": 4, "x": 0, "y": 0},
          "id": 1,
          "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "count(longhorn_volume_state{state=\"attached\"})", "refId": "A"}],
          "title": "Attached Volumes",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 1}]}, "unit": "short"}},
          "gridPos": {"h": 4, "w": 4, "x": 4, "y": 0},
          "id": 2,
          "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "count(longhorn_volume_state{state=\"detached\"}) or vector(0)", "refId": "A"}],
          "title": "Detached Volumes",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 1}]}, "unit": "short"}},
          "gridPos": {"h": 4, "w": 4, "x": 8, "y": 0},
          "id": 3,
          "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "count(longhorn_volume_robustness{robustness=\"degraded\"}) or vector(0)", "refId": "A"}],
          "title": "Degraded Volumes",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "bytes"}},
          "gridPos": {"h": 4, "w": 6, "x": 12, "y": 0},
          "id": 4,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "sum(longhorn_node_storage_capacity_bytes)", "refId": "A"}],
          "title": "Total Capacity",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 0.7}, {"color": "red", "value": 0.9}]}, "unit": "percentunit"}},
          "gridPos": {"h": 4, "w": 6, "x": 18, "y": 0},
          "id": 5,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "sum(longhorn_node_storage_usage_bytes) / sum(longhorn_node_storage_capacity_bytes)", "refId": "A"}],
          "title": "Storage Used %",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false, "stacking": {"group": "A", "mode": "none"}, "thresholdsStyle": {"mode": "off"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "bytes"}},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 4},
          "id": 6,
          "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "none"}},
          "targets": [{"expr": "longhorn_volume_actual_size_bytes", "legendFormat": "{{ "{{" }}volume{{ "}}" }}", "refId": "A"}],
          "title": "Volume Actual Size",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false, "stacking": {"group": "A", "mode": "none"}, "thresholdsStyle": {"mode": "off"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "Bps"}},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 4},
          "id": 7,
          "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "none"}},
          "targets": [{"expr": "rate(longhorn_volume_read_throughput[5m])", "legendFormat": "{{ "{{" }}volume{{ "}}" }} read", "refId": "A"}, {"expr": "rate(longhorn_volume_write_throughput[5m])", "legendFormat": "{{ "{{" }}volume{{ "}}" }} write", "refId": "B"}],
          "title": "Volume Throughput",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false, "stacking": {"group": "A", "mode": "none"}, "thresholdsStyle": {"mode": "off"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "iops"}},
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 12},
          "id": 8,
          "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "none"}},
          "targets": [{"expr": "rate(longhorn_volume_read_iops[5m])", "legendFormat": "{{ "{{" }}volume{{ "}}" }} read", "refId": "A"}, {"expr": "rate(longhorn_volume_write_iops[5m])", "legendFormat": "{{ "{{" }}volume{{ "}}" }} write", "refId": "B"}],
          "title": "Volume IOPS",
          "type": "timeseries"
        }
      ],
      "schemaVersion": 38,
      "style": "dark",
      "tags": ["longhorn", "storage"],
      "templating": {
        "list": [
          {"current": {"selected": false, "text": "VictoriaMetrics", "value": "VictoriaMetrics"}, "hide": 0, "includeAll": false, "label": "Datasource", "multi": false, "name": "datasource", "options": [], "query": "prometheus", "refresh": 1, "regex": "", "skipUrlSync": false, "type": "datasource"}
        ]
      },
      "time": {"from": "now-1h", "to": "now"},
      "timepicker": {},
      "timezone": "",
      "title": "Longhorn",
      "uid": "longhorn-homelab",
      "version": 1
    }

---
# Cert-Manager Dashboard
# Source: https://grafana.com/grafana/dashboards/11001
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-cert-manager
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
  annotations:
    grafana_folder: "Infrastructure"
data:
  cert-manager.json: |
    {
      "annotations": {"list": []},
      "description": "Cert-Manager certificate status and expiry",
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "links": [],
      "liveNow": false,
      "panels": [
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}},
          "gridPos": {"h": 4, "w": 6, "x": 0, "y": 0},
          "id": 1,
          "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "count(certmanager_certificate_ready_status{condition=\"True\"})", "refId": "A"}],
          "title": "Ready Certificates",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 1}]}, "unit": "short"}},
          "gridPos": {"h": 4, "w": 6, "x": 6, "y": 0},
          "id": 2,
          "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "count(certmanager_certificate_ready_status{condition=\"False\"}) or vector(0)", "refId": "A"}],
          "title": "Not Ready Certificates",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "yellow", "value": 604800}, {"color": "green", "value": 2592000}]}, "unit": "s"}},
          "gridPos": {"h": 4, "w": 6, "x": 12, "y": 0},
          "id": 3,
          "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["min"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "min(certmanager_certificate_expiration_timestamp_seconds - time())", "refId": "A"}],
          "title": "Earliest Expiry",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}},
          "gridPos": {"h": 4, "w": 6, "x": 18, "y": 0},
          "id": 4,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "sum(increase(certmanager_http_acme_client_request_count[24h]))", "refId": "A"}],
          "title": "ACME Requests (24h)",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false, "stacking": {"group": "A", "mode": "none"}, "thresholdsStyle": {"mode": "line+area"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "transparent", "value": 604800}]}, "unit": "s"}},
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 4},
          "id": 5,
          "options": {"legend": {"calcs": ["lastNotNull"], "displayMode": "table", "placement": "right", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "targets": [{"expr": "certmanager_certificate_expiration_timestamp_seconds - time()", "legendFormat": "{{ "{{" }}namespace{{ "}}" }}/{{ "{{" }}name{{ "}}" }}", "refId": "A"}],
          "title": "Certificate Time Until Expiry",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"align": "auto", "displayMode": "color-background", "inspect": false}, "mappings": [{"options": {"0": {"color": "red", "index": 1, "text": "Not Ready"}, "1": {"color": "green", "index": 0, "text": "Ready"}}, "type": "value"}], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}}},
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 12},
          "id": 6,
          "options": {"footer": {"fields": "", "reducer": ["sum"], "show": false}, "showHeader": true, "sortBy": [{"desc": false, "displayName": "Time Until Expiry"}]},
          "targets": [{"expr": "certmanager_certificate_ready_status{condition=\"True\"}", "format": "table", "instant": true, "refId": "A"}, {"expr": "certmanager_certificate_expiration_timestamp_seconds - time()", "format": "table", "instant": true, "refId": "B"}],
          "title": "Certificate Status",
          "transformations": [{"id": "seriesToColumns", "options": {"byField": "name"}}, {"id": "organize", "options": {"excludeByName": {"Time": true, "Time 1": true, "Time 2": true, "Value #A": false, "__name__": true, "__name__ 1": true, "__name__ 2": true, "condition": true, "exported_namespace": true, "exported_namespace 1": true, "exported_namespace 2": true, "instance": true, "instance 1": true, "instance 2": true, "issuer_group": true, "issuer_group 1": true, "issuer_group 2": true, "issuer_kind": true, "issuer_kind 1": true, "issuer_kind 2": true, "issuer_name": true, "issuer_name 1": true, "issuer_name 2": true, "job": true, "job 1": true, "job 2": true, "name 1": true, "namespace 1": true, "namespace 2": true}, "indexByName": {}, "renameByName": {"Value #A": "Ready", "Value #B": "Time Until Expiry", "name": "Certificate", "namespace": "Namespace"}}}],
          "type": "table"
        }
      ],
      "schemaVersion": 38,
      "style": "dark",
      "tags": ["cert-manager", "certificates", "tls"],
      "templating": {
        "list": [
          {"current": {"selected": false, "text": "VictoriaMetrics", "value": "VictoriaMetrics"}, "hide": 0, "includeAll": false, "label": "Datasource", "multi": false, "name": "datasource", "options": [], "query": "prometheus", "refresh": 1, "regex": "", "skipUrlSync": false, "type": "datasource"}
        ]
      },
      "time": {"from": "now-1h", "to": "now"},
      "timepicker": {},
      "timezone": "",
      "title": "Cert-Manager",
      "uid": "cert-manager-homelab",
      "version": 1
    }

---
# Loki Logs Dashboard
# Source: Custom dashboard for log exploration
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-loki-logs
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
  annotations:
    grafana_folder: "Logs"
data:
  loki-logs.json: |
    {
      "annotations": {"list": []},
      "description": "Explore logs from all namespaces via Loki",
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "links": [],
      "liveNow": false,
      "panels": [
        {
          "datasource": {"type": "loki", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}},
          "gridPos": {"h": 4, "w": 6, "x": 0, "y": 0},
          "id": 1,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["sum"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "sum(count_over_time({namespace=~\"$namespace\"} [1h]))", "refId": "A"}],
          "title": "Logs (1h)",
          "type": "stat"
        },
        {
          "datasource": {"type": "loki", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 1}]}, "unit": "short"}},
          "gridPos": {"h": 4, "w": 6, "x": 6, "y": 0},
          "id": 2,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["sum"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "sum(count_over_time({namespace=~\"$namespace\"} |= \"error\" [1h]))", "refId": "A"}],
          "title": "Errors (1h)",
          "type": "stat"
        },
        {
          "datasource": {"type": "loki", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 1}]}, "unit": "short"}},
          "gridPos": {"h": 4, "w": 6, "x": 12, "y": 0},
          "id": 3,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["sum"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "sum(count_over_time({namespace=~\"$namespace\"} |= \"warn\" [1h]))", "refId": "A"}],
          "title": "Warnings (1h)",
          "type": "stat"
        },
        {
          "datasource": {"type": "loki", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}},
          "gridPos": {"h": 4, "w": 6, "x": 18, "y": 0},
          "id": 4,
          "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "count(count by (namespace) (rate({namespace=~\".+\"}[5m])))", "refId": "A"}],
          "title": "Active Namespaces",
          "type": "stat"
        },
        {
          "datasource": {"type": "loki", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "bars", "fillOpacity": 100, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false, "stacking": {"group": "A", "mode": "normal"}, "thresholdsStyle": {"mode": "off"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}},
          "gridPos": {"h": 6, "w": 24, "x": 0, "y": 4},
          "id": 5,
          "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "targets": [{"expr": "sum by (namespace) (count_over_time({namespace=~\"$namespace\"}[$__interval]))", "legendFormat": "{{ "{{" }}namespace{{ "}}" }}", "refId": "A"}],
          "title": "Log Volume by Namespace",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "loki", "uid": "${datasource}"},
          "gridPos": {"h": 14, "w": 24, "x": 0, "y": 10},
          "id": 6,
          "options": {"dedupStrategy": "none", "enableLogDetails": true, "prettifyLogMessage": false, "showCommonLabels": false, "showLabels": false, "showTime": true, "sortOrder": "Descending", "wrapLogMessage": false},
          "targets": [{"expr": "{namespace=~\"$namespace\", pod=~\"$pod\"} |= \"$search\"", "refId": "A"}],
          "title": "Logs",
          "type": "logs"
        }
      ],
      "schemaVersion": 38,
      "style": "dark",
      "tags": ["loki", "logs"],
      "templating": {
        "list": [
          {"current": {"selected": false, "text": "Loki", "value": "Loki"}, "hide": 0, "includeAll": false, "label": "Datasource", "multi": false, "name": "datasource", "options": [], "query": "loki", "refresh": 1, "regex": "", "skipUrlSync": false, "type": "datasource"},
          {"current": {"selected": true, "text": ["All"], "value": ["$__all"]}, "datasource": {"type": "loki", "uid": "${datasource}"}, "definition": "label_values(namespace)", "hide": 0, "includeAll": true, "label": "Namespace", "multi": true, "name": "namespace", "options": [], "query": "label_values(namespace)", "refresh": 2, "regex": "", "skipUrlSync": false, "sort": 1, "type": "query"},
          {"current": {"selected": true, "text": ["All"], "value": ["$__all"]}, "datasource": {"type": "loki", "uid": "${datasource}"}, "definition": "label_values({namespace=~\"$namespace\"}, pod)", "hide": 0, "includeAll": true, "label": "Pod", "multi": true, "name": "pod", "options": [], "query": "label_values({namespace=~\"$namespace\"}, pod)", "refresh": 2, "regex": "", "skipUrlSync": false, "sort": 1, "type": "query"},
          {"current": {"selected": false, "text": "", "value": ""}, "hide": 0, "label": "Search", "name": "search", "options": [{"selected": true, "text": "", "value": ""}], "query": "", "skipUrlSync": false, "type": "textbox"}
        ]
      },
      "time": {"from": "now-1h", "to": "now"},
      "timepicker": {},
      "timezone": "",
      "title": "Loki Logs Explorer",
      "uid": "loki-logs-homelab",
      "version": 1
    }

