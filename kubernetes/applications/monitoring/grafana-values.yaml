---
# Standalone Grafana Helm Values
# Configured to use Victoria Metrics as datasource

# Single replica for homelab
replicas: 1

# Admin credentials from existing secret
admin:
  existingSecret: grafana-admin-secret
  userKey: admin-user
  passwordKey: admin-password

# Persistence for dashboards
persistence:
  enabled: true
  storageClassName: longhorn
  size: 5Gi

# Service configuration
service:
  type: ClusterIP
  port: 80

# Disable ingress (using Traefik IngressRoute)
ingress:
  enabled: false

# Resources (no sidecars = much lower memory)
resources:
  requests:
    cpu: 50m
    memory: 128Mi
  limits:
    cpu: 300m
    memory: 256Mi

# Disable sidecars (major memory savings)
sidecar:
  dashboards:
    enabled: false
  datasources:
    enabled: false

# Grafana configuration
grafana.ini:
  server:
    serve_from_sub_path: false
  auth.anonymous:
    enabled: false
  # Feature toggles
  feature_toggles:
    enable: "publicDashboards"

# Environment from secret
envFromSecret: grafana-admin-secret

# Datasources - Victoria Metrics (Prometheus compatible)
datasources:
  datasources.yaml:
    apiVersion: 1
    datasources:
      - name: VictoriaMetrics
        type: prometheus
        url: http://vmsingle-vmsingle.monitoring.svc:8429
        access: proxy
        isDefault: true
        editable: true
        jsonData:
          timeInterval: "60s"
          httpMethod: "POST"
      # Alertmanager datasource for alert status
      - name: Alertmanager
        type: alertmanager
        url: http://vmalertmanager-vmalertmanager.monitoring.svc:9093
        access: proxy
        jsonData:
          implementation: prometheus

# Dashboard providers
dashboardProviders:
  dashboardproviders.yaml:
    apiVersion: 1
    providers:
      - name: "default"
        orgId: 1
        folder: ""
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/default

# Pre-load dashboards from Grafana.com
dashboards:
  default:
    # Victoria Metrics single-node dashboard
    victoriametrics:
      gnetId: 10229
      revision: 35
      datasource: VictoriaMetrics
    
    # Kubernetes cluster monitoring (original from kube-prometheus-stack)
    kubernetes-cluster:
      gnetId: 7249
      revision: 1
      datasource: VictoriaMetrics
    
    # Node exporter full
    node-exporter:
      gnetId: 1860
      revision: 31
      datasource: VictoriaMetrics
    
    # Persistent volumes (original from kube-prometheus-stack)
    persistent-volumes:
      gnetId: 13646
      revision: 2
      datasource: VictoriaMetrics
    
    # Kubernetes pods
    kubernetes-pods:
      gnetId: 6336
      revision: 1
      datasource: VictoriaMetrics
