---
# Homepage Helm Chart Values
# https://github.com/jameswynn/helm-charts/tree/main/charts/homepage
#
# This configures the official Homepage chart with:
# - Kubernetes service discovery via RBAC
# - External ConfigMaps for services, settings, widgets
# - Environment variables for API secrets

# Container image
image:
  repository: ghcr.io/gethomepage/homepage
  tag: latest
  pullPolicy: IfNotPresent

# Enable ServiceAccount with RBAC for Kubernetes discovery
enableRbac: true

serviceAccount:
  create: true
  name: homepage
  annotations: {}

# Resource limits
resources:
  requests:
    cpu: 50m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 256Mi

# Service configuration
service:
  main:
    ports:
      http:
        port: 3000

# Environment variables from secrets
env:
  # Allow requests from custom domain (required for reverse proxy)
  HOMEPAGE_ALLOWED_HOSTS: "home.silverseekers.org"
  # Proxmox API token (from sealed secret)
  HOMEPAGE_VAR_PROXMOX_TOKEN_ID:
    valueFrom:
      secretKeyRef:
        name: homepage-secrets
        key: proxmox-token-id
  HOMEPAGE_VAR_PROXMOX_TOKEN_SECRET:
    valueFrom:
      secretKeyRef:
        name: homepage-secrets
        key: proxmox-token-secret
  # OpenWeatherMap API key (optional)
  HOMEPAGE_VAR_OPENWEATHER_API_KEY:
    valueFrom:
      secretKeyRef:
        name: homepage-secrets
        key: openweather-api-key
        optional: true

# Configuration - use existing ConfigMap created by our local templates
# This allows us to include all required files (proxmox.yaml, custom.css, etc.)
config:
  # Use the ConfigMap we create in templates/configmap-complete.yaml
  useExistingConfigMap: homepage-config

# Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

# Container security context
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false

# Liveness and readiness probes
livenessProbe:
  httpGet:
    path: /api/healthcheck
    port: 3000
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 3
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /api/healthcheck
    port: 3000
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

